<div class="ubicaciones-container">
  <!-- Encabezado -->
  <div class="page-header">
    <div>
      <h1> Gesti贸n de Ubicaciones</h1>
      
    </div>
    <button *ngIf="tienePrivilegio('ubicaciones.Editar')" class="btn-primary btn-nueva-ubicacion" (click)="abrirModal()">
      <i class="bi bi-plus-circle me-2"></i>Nueva Ubicaci贸n
    </button>
  </div>

   
  
  <div *ngIf="errorMessage" class="alert alert-error">
    <i class="bi bi-exclamation-triangle me-2"></i>{{ errorMessage }}
    <button type="button" class="btn-cerrar-alerta" (click)="errorMessage = ''"></button>
  </div>

  <!-- Stats + Banner -->
<div class="stats-banner-layout">

  <!-- COLUMNA IZQUIERDA: CARDS -->
  <div class="stats-cards small">
    <div class="stat-card total">
      <div class="stat-card-icon">
        <i class="bi bi-box-seam"></i>
      </div>
      <div class="stat-label">Total</div>
      <div class="stat-value">{{ totalRegistros }}</div>
    </div>

    <div class="stat-card active">
      <div class="stat-card-icon">
        <i class="bi bi-check-circle"></i>
      </div>
      <div class="stat-label">Activas</div>
      <div class="stat-value">{{ ubicacionesActivas }}</div>
    </div>

    <div class="stat-card inactive">
      <div class="stat-card-icon">
        <i class="bi bi-slash-circle"></i>
      </div>
      <div class="stat-label">Inactivas</div>
      <div class="stat-value">{{ ubicacionesInactivas }}</div>
    </div>
  </div>

  <!-- COLUMNA DERECHA: IMAGEN -->
  <div class="stats-banner">
    <img
      src="https://images.unsplash.com/photo-1524252500348-1bb07b83f3be?fm=jpg&q=60&w=3000&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8Ym9zcXVlJTIwZ3Jpc3xlbnwwfHwwfHx8MA%3D%3D"
      alt="Banner"
    />
  </div>

</div>


  <!-- Filtros -->
  <div class="filter-panel">
    <div class="filter-grid">
      <div class="filter-group"> 
        <select class="filter-select" [(ngModel)]="filtroEstado" (change)="aplicarFiltros()">
          <option *ngFor="let estado of estados" [value]="estado">
            {{ estado === 'todos' ? 'Todos los estados' : 
               estado === 'activo' ? 'Solo activas' : 'Solo inactivas' }}
          </option>
        </select>
      </div>
      
      <div class="filter-group"> 
        <input type="text" class="filter-input" placeholder="Buscar por nombre o descripci贸n..."
               [(ngModel)]="filtroBusqueda" (keyup.enter)="aplicarFiltros()">
      </div>
      
      <div class="filter-actions">
        <button class="btn-outline-primary" (click)="aplicarFiltros()">
          <i class="bi bi-funnel me-1"></i>Filtrar
        </button>
        <button class="btn-outline-secondary" (click)="limpiarFiltros()">
          <i class="bi bi-x-circle me-1"></i>Limpiar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal/Popup -->
  <div *ngIf="mostrarModal" class="modal-overlay" (click)="cerrarModal($event)">
    <div class="modal-contenido" (click)="$event.stopPropagation()">
      <div class="modal-encabezado">
        <h3 class="modal-titulo">
          {{ isEditing ? '锔 Editar Ubicaci贸n' : ' Nueva Ubicaci贸n' }}
        </h3>
        <button type="button" class="btn-cerrar-modal" (click)="cerrarModal()"></button>
      </div>
      
      <form [formGroup]="ubicacionForm" (ngSubmit)="crearUbicacion()">
        <div class="modal-cuerpo">
          <div class="form-group">
            <label class="form-label required">Nombre</label>
            <input type="text" class="form-control" formControlName="nombre"
                   placeholder="Ej: Almac茅n Principal">
            
            <div *ngIf="ubicacionForm.get('nombre')?.invalid && ubicacionForm.get('nombre')?.touched" 
                 class="error-message">
              <i class="bi bi-exclamation-circle"></i>
              <span *ngIf="ubicacionForm.get('nombre')?.errors?.['required']">
                El nombre es requerido
              </span>
              <span *ngIf="ubicacionForm.get('nombre')?.errors?.['minlength']">
                M铆nimo 3 caracteres
              </span>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Descripci贸n</label>
            <textarea class="form-control" formControlName="descripcion" rows="3"
                      placeholder="Descripci贸n opcional de la ubicaci贸n..."></textarea>
          </div>

          <div class="form-group">
            <label class="form-label">Estado</label>
            <select class="form-control" formControlName="estado">
              <option value="activo">Activo</option>
              <option value="inactivo">Inactivo</option>
            </select>
          </div>
        </div>
        
        <div class="modal-pie">
          <button type="button" class="btn-cancelar" (click)="cerrarModal()">
            Cancelar
          </button>
          
          <button type="submit" class="btn-guardar" [disabled]="ubicacionForm.invalid || isLoading">
            <span *ngIf="isLoading" class="spinner-mini"></span>
            {{ isEditing ? 'Actualizar' : 'Crear' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Tabla de ubicaciones -->
  <div class="table-container">
    <div class="table-header"> 
    </div>
    
    <div class="table-content">
      <!-- Loading -->
      <div *ngIf="isLoading" class="loading-overlay">
        <div class="spinner"></div>
        <p>Cargando ubicaciones...</p>
      </div>

      <!-- Estado vac铆o -->
      <div *ngIf="!isLoading && ubicacionesx.length === 0" class="empty-state">
        <div class="empty-state-icon">
          <i class="bi bi-inbox"></i>
        </div>
        <h4 class="empty-state-title">No hay ubicaciones registradas</h4>
        <p class="empty-state-description">Comienza creando tu primera ubicaci贸n</p>
        <button class="btn-primary" (click)="abrirModal()">
          <i class="bi bi-plus-circle me-2"></i>Crear primera ubicaci贸n
        </button>
      </div>

      <!-- Tabla -->
      <table *ngIf="!isLoading && ubicacionesx.length > 0" class="ubicaciones-table">
        <thead>
          <tr>
            <th class="col-id">Numeraci贸n</th>
            <th class="col-nombre">Nombre</th>
            <th class="col-descripcion">Descripci贸n</th>
            <th>Estado</th>
            <th class="col-fecha">Creado</th>
            <th class="text-end">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let ubicacion of ubicacionesx; let i = index">
           <td class="col-id">{{ totalRegistros - ((page-1) * limit + i) }}</td>
            <td class="col-nombre">{{ ubicacion.nombre }}</td>
            <td class="col-descripcion">{{ ubicacion.descripcion || 'Sin descripci贸n' }}</td>
            <td>
              <span [class]="ubicacion.estado === 'activo' ? 'estado-activo' : 'estado-inactivo'">
                {{ ubicacion.estado === 'activo' ? 'Activo' : 'Inactivo' }}
              </span>
            </td>
            <td class="col-fecha">{{ ubicacion.created_at | date:'dd/MM/yyyy' }}</td>
            <td>
              
                <button *ngIf="tienePrivilegio('ubicaciones.Editar')" class="btn-accion btn-editar" (click)="editarUbicacion(ubicacion)" 
                        title="Editar ubicaci贸n">
                  <i class="bi bi-pencil"></i>
                </button>
                
                <button *ngIf="tienePrivilegio('ubicaciones.Editar')" class="btn-accion" 
                        [class.btn-activar]="ubicacion.estado === 'inactivo'"
                        [class.btn-desactivar]="ubicacion.estado === 'activo'"
                        (click)="cambiarEstado(ubicacion.id, ubicacion.estado === 'activo' ? 'inactivo' : 'activo')"
                        [title]="ubicacion.estado === 'activo' ? 'Desactivar' : 'Activar'">
                  <i class="bi" [class.bi-toggle-on]="ubicacion.estado === 'activo'" 
                     [class.bi-toggle-off]="ubicacion.estado === 'inactivo'"></i>
                </button>
                
                <button *ngIf="tienePrivilegio('ubicaciones.Editar')" class="btn-accion btn-eliminar" (click)="eliminarUbicacion(ubicacion.id)"
                        title="Eliminar permanentemente">
                  <i class="bi bi-trash"></i>
                </button>
              
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginaci贸n -->
    <div *ngIf="totalPaginas > 1" class="paginacion-container">
      <div class="paginacion-info">
        Mostrando {{ (page - 1) * limit + 1 }} - 
        {{ mathMin(page * limit, totalRegistros) }} de {{ totalRegistros }}
      </div>
      
      <div class="paginacion-controls">
        <button class="btn-pagina" [class.disabled]="page === 1" (click)="changePage(page - 1)">
          <i class="bi bi-chevron-left"></i>
        </button>
        
        <button *ngFor="let p of getPagesArray()" class="btn-pagina" 
                [class.active]="p === page" (click)="changePage(p)">
          {{ p }}
        </button>
        
        <button class="btn-pagina" [class.disabled]="page === totalPaginas" (click)="changePage(page + 1)">
          <i class="bi bi-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>